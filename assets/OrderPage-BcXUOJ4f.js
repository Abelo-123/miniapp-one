import{j as e,r as n}from"./react-vendor-C-oIHjE7.js";import{P as F,h as Z,f as I,u as J,g as ee,Q as te,c as V,s as re,o as se,a as ne,e as ae,d as W,b as oe,i as Y}from"./index-C6osAsRO.js";import{M as E,L as H,b as S,I as A,P as z,C as M,c as ie,B as _,d as le,e as G}from"./tma-ui-BXUja-_9.js";import"./tma-sdk-B1EfXx2E.js";function ce({selectedPlatform:s,onSelect:u}){return e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:8},children:F.map(o=>{const r=s===o.id;return e.jsxs("button",{onClick:()=>{Z(),u(o.id)},style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:4,padding:"14px 6px",background:r?"var(--tg-theme-button-color, #6c5ce7)":"var(--tg-theme-secondary-bg-color, #1e1e1e)",border:"1px solid",borderColor:r?"var(--tg-theme-button-color, #6c5ce7)":"var(--tg-theme-hint-color, #333)",borderRadius:12,cursor:"pointer",transition:"all 0.15s ease",WebkitTapHighlightColor:"transparent",color:r?"var(--tg-theme-button-text-color, #fff)":"var(--tg-theme-text-color, #fff)"},children:[e.jsx("span",{style:{fontSize:24,lineHeight:1},children:o.icon}),e.jsx("span",{style:{fontSize:11,fontWeight:500,whiteSpace:"nowrap",opacity:r?1:.7},children:o.label})]},o.id)})})}function de({categories:s,onSelect:u,onClose:o}){const[r,f]=n.useState(""),i=n.useMemo(()=>{if(!r.trim())return s;const t=r.toLowerCase();return s.filter(a=>a.toLowerCase().includes(t))},[s,r]);return e.jsx(E,{open:!0,onOpenChange:t=>{t||o()},header:e.jsx(E.Header,{children:"Select Category"}),children:e.jsxs(H,{children:[e.jsx(S,{children:e.jsx(A,{placeholder:"Search categories...",value:r,onChange:t=>f(t.target.value)})}),i.length===0?e.jsx(z,{description:"No categories found"}):e.jsx(S,{children:i.map(t=>e.jsx(M,{before:e.jsx("span",{style:{fontSize:18},children:"ðŸ“‚"}),onClick:()=>u(t),children:t},t))})]})})}function ue({services:s,onSelect:u,onClose:o}){const[r,f]=n.useState(""),i=n.useMemo(()=>{if(!r.trim())return s;const t=r.toLowerCase();return s.filter(a=>a.name.toLowerCase().includes(t)||a.id.toString().includes(t))},[s,r]);return e.jsx(E,{open:!0,onOpenChange:t=>{t||o()},header:e.jsx(E.Header,{children:"Select Service"}),snapPoints:[.85],children:e.jsxs(H,{children:[e.jsx(S,{children:e.jsx(A,{placeholder:"Search services...",value:r,onChange:t=>f(t.target.value)})}),i.length===0?e.jsx(z,{description:"No services found"}):e.jsx(S,{children:i.map(t=>e.jsx(M,{multiline:!0,onClick:()=>u(t),description:e.jsxs("span",{style:{fontSize:12},children:["#",t.id," â€¢ ",t.min," â€“ ",t.max.toLocaleString(),t.averageTime&&` â€¢ â± ${t.averageTime}`,t.refill&&" â€¢ â™» Refill",t.cancel&&" â€¢ âœ• Cancel"]}),after:e.jsx("span",{style:{fontWeight:600,color:"var(--tg-theme-link-color)"},children:I(t.rate)}),children:t.name},t.id))})]})})}function he(){const{selectedService:s,selectedPlatform:u,selectedCategory:o,rateMultiplier:r,discountPercent:f,user:i,userCanOrder:t,isTelegramApp:a,showToast:m,setBalance:h,setOrders:T,orders:k}=J(),[g,P]=n.useState(""),[j,b]=n.useState(""),[q,N]=n.useState(""),[Q,O]=n.useState(""),[w,D]=n.useState(!1),l=s,{charge:x,hasDiscount:c}=n.useMemo(()=>{const y=(parseInt(j)||0)/1e3*l.rate*r;return{charge:f>0?y*(1-f/100):y,hasDiscount:f>0}},[j,l.rate,r,f]),$=n.useCallback(d=>{const y=d.target.value;if(N(y),["Custom Comments","Custom Comments Package","Mentions with Hashtags"].includes(l.type)){const v=y.split(`
`).filter(X=>X.trim());b(String(v.length))}},[l.type]),C=ee(o||"",u||"other"),p=["Custom Comments","Custom Comments Package","Mentions with Hashtags"].includes(l.type),L=l.type!=="Package",U=l.type==="Poll",R=n.useMemo(()=>{if(!g.trim())return!1;const d=l.type==="Package"?l.min:parseInt(j);return!(!d||isNaN(d)||d<l.min||d>l.max||d%te!==0||i&&x>i.balance||!t)},[g,j,l,x,i,t]),B=async()=>{if(R){D(!0);try{await new Promise(v=>setTimeout(v,1200));const d=l.type==="Package"?l.min:parseInt(j),y={id:k.length+100,api_order_id:9e4+k.length,service_id:l.id,service_name:l.name,link:g,quantity:d,charge:x,status:"pending",remains:d,start_count:0,created_at:new Date().toISOString()};T([y,...k]),i&&h(i.balance-x),m("success",`Order #${y.api_order_id} placed!`),oe("heavy"),Y("success"),P(""),b(""),N(""),O("")}catch{m("error","Failed to place order"),Y("error")}finally{D(!1)}}},K=n.useRef(B);return n.useEffect(()=>{K.current=B},[B]),n.useEffect(()=>{if(!a)return;const d=()=>K.current();if(w)V({text:"PLACING ORDER...",isEnabled:!0,isLoaderVisible:!0});else if(R)V({text:`PAY ${I(x)}`,color:"#2ecc71",textColor:"#ffffff",isEnabled:!0,isLoaderVisible:!1});else{let v="FILL DETAILS";g.trim()?i&&x>i.balance?v="INSUFFICIENT FUNDS":v="INVALID QUANTITY":v="ENTER LINK",V({text:v,color:"#95a5a6",textColor:"#ffffff",isEnabled:!1,isLoaderVisible:!1})}re();const y=se(d);return()=>{y(),ne()}},[a,R,w,x,g,i]),n.useEffect(()=>((g||j)&&!w?ae():W(),()=>W()),[g,j,w]),e.jsxs(e.Fragment,{children:[e.jsxs(S,{header:`Selected Service: ${l.name} `,footer:i&&x>i.balance?`Insufficient Balance(Have: ${I(i.balance)})`:`Total Charge: ${I(x)} `,children:[e.jsx(M,{subtitle:`${l.min} - ${l.max.toLocaleString()} â€¢ Rate: ${I(l.rate)} `,multiline:!0,children:l.category}),c&&e.jsx(M,{before:"ðŸ”¥",after:`- ${f}% `,children:"Discount applied"})]}),e.jsxs(S,{header:"Order Details",children:[e.jsx(A,{header:"Link",placeholder:C,value:g,onChange:d=>P(d.target.value),status:!g.trim()&&g.length>0?"error":"default"}),L&&!p&&e.jsx(A,{header:"Quantity",placeholder:`Min: ${l.min} `,type:"number",value:j,onChange:d=>b(d.target.value)}),p&&e.jsx(ie,{header:"Comments (One per line)",placeholder:"Enter list of comments...",value:q,onChange:$}),U&&e.jsx(A,{header:"Answer Number",type:"number",value:Q,onChange:d=>O(d.target.value)})]}),!a&&e.jsx(S,{children:e.jsx(_,{size:"l",stretched:!0,disabled:!R||w,onClick:B,loading:w,children:w?"Ordering...":`Pay ${I(x)} `})})]})}function fe(s,u){if(!u)return e.jsx(e.Fragment,{children:s});const o=s.toLowerCase().indexOf(u.toLowerCase());return o===-1?e.jsx(e.Fragment,{children:s}):e.jsxs(e.Fragment,{children:[s.slice(0,o),e.jsx("mark",{style:{background:"var(--tg-theme-accent-text-color, rgba(108,92,231,0.3))",color:"var(--tg-theme-text-color)",borderRadius:2,padding:"0 2px",opacity:.7},children:s.slice(o,o+u.length)}),s.slice(o+u.length)]})}function me({services:s,onSelect:u,onClose:o}){const[r,f]=n.useState(""),i=n.useMemo(()=>{const a=r.trim().toLowerCase();if(!a)return[];const m=a.split(/\s+/);return s.filter(h=>{const T=`${h.name} ${h.category} ${h.id}`.toLowerCase();return m.every(k=>T.includes(k))}).slice(0,30)},[s,r]),t=n.useMemo(()=>{const a=new Map;for(const m of i){const h=a.get(m.category)||[];h.push(m),a.set(m.category,h)}return a},[i]);return e.jsx(E,{open:!0,onOpenChange:a=>{a||o()},header:e.jsx(E.Header,{children:"ðŸ” Search All Services"}),snapPoints:[.9],children:e.jsxs(H,{children:[e.jsx(S,{children:e.jsx(A,{placeholder:"Search by name, ID, or category...",value:r,onChange:a=>f(a.target.value)})}),r.trim()===""?e.jsx(z,{description:"Start typing to search across all services"}):i.length===0?e.jsx(z,{description:"No services match your search"}):Array.from(t.entries()).map(([a,m])=>e.jsx(S,{header:a,children:m.map(h=>e.jsx(M,{multiline:!0,onClick:()=>u(h),description:e.jsxs("span",{style:{fontSize:12},children:["#",h.id," â€¢ ",I(h.rate),"/1K"]}),children:fe(h.name,r.trim())},h.id))},a))]})})}function Ce(){const{services:s,recommendedIds:u,selectedPlatform:o,selectedCategory:r,selectedService:f,setSelectedPlatform:i,setSelectedCategory:t,setSelectedService:a,discountPercent:m,holidayName:h,marqueeText:T,user:k}=J(),[g,P]=n.useState(!1),[j,b]=n.useState(!1),[q,N]=n.useState(!1),Q=n.useMemo(()=>{if(!o)return[];if(o==="top")return["Top Services"];const c=F.find(C=>C.id===o);if(!c)return[];const $=[...new Set(s.map(C=>C.category))];if(o==="other"){const C=F.filter(p=>p.id!=="other"&&p.id!=="top").flatMap(p=>p.keywords);return $.filter(p=>{const L=p.toLowerCase();return!C.some(U=>L.includes(U))})}return $.filter(C=>{const p=C.toLowerCase();return c.keywords.some(L=>p.includes(L))})},[o,s]),O=n.useMemo(()=>r?r==="Top Services"?s.filter(c=>u.includes(c.id)):s.filter(c=>c.category===r):[],[r,s,u]),w=n.useCallback(c=>{i(c),c==="top"?(t("Top Services"),b(!0)):P(!0)},[i,t]),D=n.useCallback(c=>{t(c),P(!1),b(!0)},[t]),l=n.useCallback(c=>{a(c),b(!1)},[a]),x=n.useCallback(c=>{const $=c.category.toLowerCase(),C=F.find(p=>p.keywords.some(L=>$.includes(L)));i(C?.id||"other"),t(c.category),a(c),N(!1)},[i,t,a]);return e.jsxs("div",{className:"order-page-wrapper",children:[e.jsxs(H,{children:[e.jsx(S,{children:e.jsx(M,{before:e.jsx(le,{src:k?.photo_url||"",size:48,fallbackIcon:e.jsx("span",{children:"ðŸ‘¤"})}),description:`Hey ${k?.first_name||"User"}!`,after:e.jsx(_,{mode:"plain",size:"s",onClick:()=>N(!0),children:"ðŸ” Search"}),children:"Paxyo SMM"})}),T&&e.jsx(G,{header:"Announcement",description:T}),m>0&&e.jsx(G,{header:`${m}% Discount Active`,description:`Holiday Special: ${h}`,type:"section"}),e.jsx(S,{header:"Select Platform",children:e.jsx("div",{style:{padding:"0 16px 16px"},children:e.jsx(ce,{selectedPlatform:o,onSelect:w})})}),r&&e.jsxs(S,{header:"Selection",children:[e.jsx(M,{onClick:()=>P(!0),after:e.jsx(_,{mode:"plain",size:"s",children:"Change"}),description:"Category",children:r}),f&&e.jsx(M,{onClick:()=>b(!0),after:e.jsx(_,{mode:"plain",size:"s",children:"Change"}),description:"Service",multiline:!0,children:f.name})]}),f&&e.jsx(he,{})]}),g&&e.jsx(de,{categories:Q,onSelect:D,onClose:()=>P(!1)}),j&&e.jsx(ue,{services:O,onSelect:l,onClose:()=>b(!1)}),q&&e.jsx(me,{services:s,onSelect:x,onClose:()=>N(!1)})]})}export{Ce as OrderPage};
