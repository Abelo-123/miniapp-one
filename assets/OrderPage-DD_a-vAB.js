import{j as e,r as n}from"./react-vendor-C-oIHjE7.js";import{P as z,h as Z,f as P,u as J,g as ee,Q as te,c as V,s as re,o as se,a as ne,e as ae,d as Y,p as oe,b as ie,i as K}from"./index-D32_aHZK.js";import{M as O,L as Q,b as S,I as A,P as q,C as k,c as le,B as H,d as ce,e as G}from"./tma-ui-BXUja-_9.js";import"./tma-sdk-B1EfXx2E.js";function de({selectedPlatform:s,onSelect:u}){return e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:8},children:z.map(o=>{const r=s===o.id;return e.jsxs("button",{onClick:()=>{Z(),u(o.id)},style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:4,padding:"14px 6px",background:r?"var(--tg-theme-button-color, #6c5ce7)":"var(--tg-theme-secondary-bg-color, #1e1e1e)",border:"1px solid",borderColor:r?"var(--tg-theme-button-color, #6c5ce7)":"var(--tg-theme-hint-color, #333)",borderRadius:12,cursor:"pointer",transition:"all 0.15s ease",WebkitTapHighlightColor:"transparent",color:r?"var(--tg-theme-button-text-color, #fff)":"var(--tg-theme-text-color, #fff)"},children:[e.jsx("span",{style:{fontSize:24,lineHeight:1},children:o.icon}),e.jsx("span",{style:{fontSize:11,fontWeight:500,whiteSpace:"nowrap",opacity:r?1:.7},children:o.label})]},o.id)})})}function ue({categories:s,onSelect:u,onClose:o}){const[r,f]=n.useState(""),i=n.useMemo(()=>{if(!r.trim())return s;const t=r.toLowerCase();return s.filter(a=>a.toLowerCase().includes(t))},[s,r]);return e.jsx(O,{open:!0,onOpenChange:t=>{t||o()},header:e.jsx(O.Header,{children:"Select Category"}),children:e.jsxs(Q,{children:[e.jsx(S,{children:e.jsx(A,{placeholder:"Search categories...",value:r,onChange:t=>f(t.target.value)})}),i.length===0?e.jsx(q,{description:"No categories found"}):e.jsx(S,{children:i.map(t=>e.jsx(k,{before:e.jsx("span",{style:{fontSize:18},children:"ðŸ“‚"}),onClick:()=>u(t),children:t},t))})]})})}function he({services:s,onSelect:u,onClose:o}){const[r,f]=n.useState(""),i=n.useMemo(()=>{if(!r.trim())return s;const t=r.toLowerCase();return s.filter(a=>a.name.toLowerCase().includes(t)||a.id.toString().includes(t))},[s,r]);return e.jsx(O,{open:!0,onOpenChange:t=>{t||o()},header:e.jsx(O.Header,{children:"Select Service"}),snapPoints:[.85],children:e.jsxs(Q,{children:[e.jsx(S,{children:e.jsx(A,{placeholder:"Search services...",value:r,onChange:t=>f(t.target.value)})}),i.length===0?e.jsx(q,{description:"No services found"}):e.jsx(S,{children:i.map(t=>e.jsx(k,{multiline:!0,onClick:()=>u(t),description:e.jsxs("span",{style:{fontSize:12},children:["#",t.id," â€¢ ",t.min," â€“ ",t.max.toLocaleString(),t.averageTime&&` â€¢ â± ${t.averageTime}`,t.refill&&" â€¢ â™» Refill",t.cancel&&" â€¢ âœ• Cancel"]}),after:e.jsx("span",{style:{fontWeight:600,color:"var(--tg-theme-link-color)"},children:P(t.rate)}),children:t.name},t.id))})]})})}function fe(){const{selectedService:s,selectedPlatform:u,selectedCategory:o,rateMultiplier:r,discountPercent:f,user:i,userCanOrder:t,isTelegramApp:a,showToast:m,setBalance:h,setOrders:I,orders:T}=J(),[g,M]=n.useState(""),[y,b]=n.useState(""),[_,N]=n.useState(""),[E,D]=n.useState(""),[v,F]=n.useState(!1),l=s,{charge:C,hasDiscount:d}=n.useMemo(()=>{const p=(parseInt(y)||0)/1e3*l.rate*r;return{charge:f>0?p*(1-f/100):p,hasDiscount:f>0}},[y,l.rate,r,f]),$=n.useCallback(c=>{const p=c.target.value;if(N(p),["Custom Comments","Custom Comments Package","Mentions with Hashtags"].includes(l.type)){const w=p.split(`
`).filter(X=>X.trim());b(String(w.length))}},[l.type]),j=ee(o||"",u||"other"),x=["Custom Comments","Custom Comments Package","Mentions with Hashtags"].includes(l.type),L=l.type!=="Package",U=l.type==="Poll",R=n.useMemo(()=>{if(!g.trim())return!1;const c=l.type==="Package"?l.min:parseInt(y);return!(!c||isNaN(c)||c<l.min||c>l.max||c%te!==0||i&&C>i.balance||!t)},[g,y,l,C,i,t]),B=async()=>{if(R){F(!0);try{const c=l.type==="Package"?l.min:parseInt(y),p=await oe({service:l.id,link:g,quantity:c,tg_id:i?.id,comments:_||void 0,answer_number:E?parseInt(E):void 0});if(p.success){const w={id:p.order_id,api_order_id:p.order_id,service_id:l.id,service_name:l.name,link:g,quantity:c,charge:C,status:"pending",remains:c,start_count:0,created_at:new Date().toISOString()};I([w,...T]),i&&h(p.new_balance),m("success",`Order #${p.order_id} placed!`),ie("heavy"),K("success"),M(""),b(""),N(""),D("")}else m("error",p.error||"Failed to place order"),K("error")}catch(c){m("error",c.message||"Failed to place order"),K("error")}finally{F(!1)}}},W=n.useRef(B);return n.useEffect(()=>{W.current=B},[B]),n.useEffect(()=>{if(!a)return;const c=()=>W.current();if(v)V({text:"PLACING ORDER...",isEnabled:!0,isLoaderVisible:!0});else if(R)V({text:`PAY ${P(C)}`,color:"#2ecc71",textColor:"#ffffff",isEnabled:!0,isLoaderVisible:!1});else{let w="FILL DETAILS";g.trim()?i&&C>i.balance?w="INSUFFICIENT FUNDS":w="INVALID QUANTITY":w="ENTER LINK",V({text:w,color:"#95a5a6",textColor:"#ffffff",isEnabled:!1,isLoaderVisible:!1})}re();const p=se(c);return()=>{p(),ne()}},[a,R,v,C,g,i]),n.useEffect(()=>((g||y)&&!v?ae():Y(),()=>Y()),[g,y,v]),e.jsxs(e.Fragment,{children:[e.jsxs(S,{header:`Selected Service: ${l.name} `,footer:i&&C>i.balance?`Insufficient Balance(Have: ${P(i.balance)})`:`Total Charge: ${P(C)} `,children:[e.jsx(k,{subtitle:`${l.min} - ${l.max.toLocaleString()} â€¢ Rate: ${P(l.rate)} `,multiline:!0,children:l.category}),d&&e.jsx(k,{before:"ðŸ”¥",after:`- ${f}% `,children:"Discount applied"})]}),e.jsxs(S,{header:"Order Details",children:[e.jsx(A,{header:"Link",placeholder:j,value:g,onChange:c=>M(c.target.value),status:!g.trim()&&g.length>0?"error":"default"}),L&&!x&&e.jsx(A,{header:"Quantity",placeholder:`Min: ${l.min} `,type:"number",value:y,onChange:c=>b(c.target.value)}),x&&e.jsx(le,{header:"Comments (One per line)",placeholder:"Enter list of comments...",value:_,onChange:$}),U&&e.jsx(A,{header:"Answer Number",type:"number",value:E,onChange:c=>D(c.target.value)})]}),!a&&e.jsx(S,{children:e.jsx(H,{size:"l",stretched:!0,disabled:!R||v,onClick:B,loading:v,children:v?"Ordering...":`Pay ${P(C)} `})})]})}function me(s,u){if(!u)return e.jsx(e.Fragment,{children:s});const o=s.toLowerCase().indexOf(u.toLowerCase());return o===-1?e.jsx(e.Fragment,{children:s}):e.jsxs(e.Fragment,{children:[s.slice(0,o),e.jsx("mark",{style:{background:"var(--tg-theme-accent-text-color, rgba(108,92,231,0.3))",color:"var(--tg-theme-text-color)",borderRadius:2,padding:"0 2px",opacity:.7},children:s.slice(o,o+u.length)}),s.slice(o+u.length)]})}function pe({services:s,onSelect:u,onClose:o}){const[r,f]=n.useState(""),i=n.useMemo(()=>{const a=r.trim().toLowerCase();if(!a)return[];const m=a.split(/\s+/);return s.filter(h=>{const I=`${h.name} ${h.category} ${h.id}`.toLowerCase();return m.every(T=>I.includes(T))}).slice(0,30)},[s,r]),t=n.useMemo(()=>{const a=new Map;for(const m of i){const h=a.get(m.category)||[];h.push(m),a.set(m.category,h)}return a},[i]);return e.jsx(O,{open:!0,onOpenChange:a=>{a||o()},header:e.jsx(O.Header,{children:"ðŸ” Search All Services"}),snapPoints:[.9],children:e.jsxs(Q,{children:[e.jsx(S,{children:e.jsx(A,{placeholder:"Search by name, ID, or category...",value:r,onChange:a=>f(a.target.value)})}),r.trim()===""?e.jsx(q,{description:"Start typing to search across all services"}):i.length===0?e.jsx(q,{description:"No services match your search"}):Array.from(t.entries()).map(([a,m])=>e.jsx(S,{header:a,children:m.map(h=>e.jsx(k,{multiline:!0,onClick:()=>u(h),description:e.jsxs("span",{style:{fontSize:12},children:["#",h.id," â€¢ ",P(h.rate),"/1K"]}),children:me(h.name,r.trim())},h.id))},a))]})})}function je(){const{services:s,recommendedIds:u,selectedPlatform:o,selectedCategory:r,selectedService:f,setSelectedPlatform:i,setSelectedCategory:t,setSelectedService:a,discountPercent:m,holidayName:h,marqueeText:I,user:T}=J(),[g,M]=n.useState(!1),[y,b]=n.useState(!1),[_,N]=n.useState(!1),E=n.useMemo(()=>{if(!o)return[];if(o==="top")return["Top Services"];const d=z.find(j=>j.id===o);if(!d)return[];const $=[...new Set(s.map(j=>j.category))];if(o==="other"){const j=z.filter(x=>x.id!=="other"&&x.id!=="top").flatMap(x=>x.keywords);return $.filter(x=>{const L=x.toLowerCase();return!j.some(U=>L.includes(U))})}return $.filter(j=>{const x=j.toLowerCase();return d.keywords.some(L=>x.includes(L))})},[o,s]),D=n.useMemo(()=>r?r==="Top Services"?s.filter(d=>u.includes(d.id)):s.filter(d=>d.category===r):[],[r,s,u]),v=n.useCallback(d=>{i(d),d==="top"?(t("Top Services"),b(!0)):M(!0)},[i,t]),F=n.useCallback(d=>{t(d),M(!1),b(!0)},[t]),l=n.useCallback(d=>{a(d),b(!1)},[a]),C=n.useCallback(d=>{const $=d.category.toLowerCase(),j=z.find(x=>x.keywords.some(L=>$.includes(L)));i(j?.id||"other"),t(d.category),a(d),N(!1)},[i,t,a]);return e.jsxs("div",{className:"order-page-wrapper",children:[e.jsxs(Q,{children:[e.jsx(S,{children:e.jsx(k,{before:e.jsx(ce,{src:T?.photo_url||"",size:48,fallbackIcon:e.jsx("span",{children:"ðŸ‘¤"})}),description:`Hey ${T?.first_name||"User"}!`,after:e.jsx(H,{mode:"plain",size:"s",onClick:()=>N(!0),children:"ðŸ” Search"}),children:"Paxyo SMM"})}),I&&e.jsx(G,{header:"Announcement",description:I}),m>0&&e.jsx(G,{header:`${m}% Discount Active`,description:`Holiday Special: ${h}`,type:"section"}),e.jsx(S,{header:"Select Platform",children:e.jsx("div",{style:{padding:"0 16px 16px"},children:e.jsx(de,{selectedPlatform:o,onSelect:v})})}),r&&e.jsxs(S,{header:"Selection",children:[e.jsx(k,{onClick:()=>M(!0),after:e.jsx(H,{mode:"plain",size:"s",children:"Change"}),description:"Category",children:r}),f&&e.jsx(k,{onClick:()=>b(!0),after:e.jsx(H,{mode:"plain",size:"s",children:"Change"}),description:"Service",multiline:!0,children:f.name})]}),f&&e.jsx(fe,{})]}),g&&e.jsx(ue,{categories:E,onSelect:F,onClose:()=>M(!1)}),y&&e.jsx(he,{services:D,onSelect:l,onClose:()=>b(!1)}),_&&e.jsx(pe,{services:s,onSelect:C,onClose:()=>N(!1)})]})}export{je as OrderPage};
