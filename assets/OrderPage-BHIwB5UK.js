import{j as e,r}from"./react-vendor-C-oIHjE7.js";import{P as R,h as _,f as S,u as U,g as X,Q as Z,c as D,s as ee,o as te,a as se,e as re,d as H,b as ae,i as V}from"./index-G9JVDcjH.js";import{M as E,L as z,b as C,I as N,P as Y,C as O,c as ne,B as oe}from"./tma-ui-zNZ4TOi0.js";import"./tma-sdk-CX7cczhn.js";function ie({selectedPlatform:d,onSelect:p}){return e.jsx("div",{className:"platform-grid",children:R.map(n=>{const a=d===n.id;return e.jsxs("button",{className:`platform-pill ${a?"platform-pill--active":""}`,onClick:()=>{_(),p(n.id)},children:[e.jsx("span",{className:`platform-pill-icon platform-icon--${n.id}`,children:n.icon}),e.jsx("span",{className:"platform-pill-label",children:n.label})]},n.id)})})}function le({categories:d,onSelect:p,onClose:n}){const[a,m]=r.useState(""),i=r.useMemo(()=>{if(!a.trim())return d;const t=a.toLowerCase();return d.filter(h=>h.toLowerCase().includes(t))},[d,a]);return e.jsx(E,{open:!0,onOpenChange:t=>{t||n()},header:e.jsx(E.Header,{children:"Select Category"}),children:e.jsxs(z,{children:[e.jsx(C,{children:e.jsx(N,{placeholder:"Search categories...",value:a,onChange:t=>m(t.target.value)})}),i.length===0?e.jsx(Y,{description:"No categories found"}):e.jsx(C,{children:i.map(t=>e.jsx(O,{before:e.jsx("span",{style:{fontSize:18},children:"ðŸ“‚"}),onClick:()=>p(t),children:t},t))})]})})}function ce({services:d,onSelect:p,onClose:n}){const[a,m]=r.useState(""),i=r.useMemo(()=>{if(!a.trim())return d;const t=a.toLowerCase();return d.filter(h=>h.name.toLowerCase().includes(t)||h.id.toString().includes(t))},[d,a]);return e.jsx(E,{open:!0,onOpenChange:t=>{t||n()},header:e.jsx(E.Header,{children:"Select Service"}),snapPoints:[.85],children:e.jsxs(z,{children:[e.jsx(C,{children:e.jsx(N,{placeholder:"Search services...",value:a,onChange:t=>m(t.target.value)})}),i.length===0?e.jsx(Y,{description:"No services found"}):e.jsx(C,{children:i.map(t=>e.jsx(O,{multiline:!0,onClick:()=>p(t),description:e.jsxs("span",{style:{fontSize:12},children:["#",t.id," â€¢ ",t.min," â€“ ",t.max.toLocaleString(),t.averageTime&&` â€¢ â± ${t.averageTime}`,t.refill&&" â€¢ â™» Refill",t.cancel&&" â€¢ âœ• Cancel"]}),after:e.jsx("span",{style:{fontWeight:600,color:"var(--tg-theme-link-color)"},children:S(t.rate)}),children:t.name},t.id))})]})})}function de(){const{selectedService:d,selectedPlatform:p,selectedCategory:n,rateMultiplier:a,discountPercent:m,user:i,userCanOrder:t,isTelegramApp:h,showToast:j,setBalance:$,setOrders:P,orders:b}=U(),[u,M]=r.useState(""),[f,y]=r.useState(""),[A,k]=r.useState(""),[q,L]=r.useState(""),[o,w]=r.useState(!1),s=d,{charge:l,hasDiscount:v}=r.useMemo(()=>{const g=(parseInt(f)||0)/1e3*s.rate*a;return{charge:m>0?g*(1-m/100):g,hasDiscount:m>0}},[f,s.rate,a,m]),B=r.useCallback(c=>{const g=c.target.value;if(k(g),["Custom Comments","Custom Comments Package","Mentions with Hashtags"].includes(s.type)){const x=g.split(`
`).filter(J=>J.trim());y(String(x.length))}},[s.type]),G=X(n||"",p||"other"),F=["Custom Comments","Custom Comments Package","Mentions with Hashtags"].includes(s.type),K=s.type!=="Package",W=s.type==="Poll",T=r.useMemo(()=>{if(!u.trim())return!1;const c=s.type==="Package"?s.min:parseInt(f);return!(!c||isNaN(c)||c<s.min||c>s.max||c%Z!==0||i&&l>i.balance||!t)},[u,f,s,l,i,t]),I=async()=>{if(T){w(!0);try{await new Promise(x=>setTimeout(x,1200));const c=s.type==="Package"?s.min:parseInt(f),g={id:b.length+100,api_order_id:9e4+b.length,service_id:s.id,service_name:s.name,link:u,quantity:c,charge:l,status:"pending",remains:c,start_count:0,created_at:new Date().toISOString()};P([g,...b]),i&&$(i.balance-l),j("success",`Order #${g.api_order_id} placed!`),ae("heavy"),V("success"),M(""),y(""),k(""),L("")}catch{j("error","Failed to place order"),V("error")}finally{w(!1)}}},Q=r.useRef(I);return r.useEffect(()=>{Q.current=I},[I]),r.useEffect(()=>{if(!h)return;const c=()=>Q.current();if(o)D({text:"PLACING ORDER...",isEnabled:!0,isLoaderVisible:!0});else if(T)D({text:`PAY ${S(l)}`,color:"#2ecc71",textColor:"#ffffff",isEnabled:!0,isLoaderVisible:!1});else{let x="FILL DETAILS";u.trim()?i&&l>i.balance?x="INSUFFICIENT FUNDS":x="INVALID QUANTITY":x="ENTER LINK",D({text:x,color:"#95a5a6",textColor:"#ffffff",isEnabled:!1,isLoaderVisible:!1})}ee();const g=te(c);return()=>{g(),se()}},[h,T,o,l,u,i]),r.useEffect(()=>((u||f)&&!o?re():H(),()=>H()),[u,f,o]),e.jsxs(e.Fragment,{children:[e.jsxs(C,{header:`Selected Service: ${s.name} `,footer:i&&l>i.balance?`Insufficient Balance(Have: ${S(i.balance)})`:`Total Charge: ${S(l)} `,children:[e.jsx(O,{subtitle:`${s.min} - ${s.max.toLocaleString()} â€¢ Rate: ${S(s.rate)} `,multiline:!0,children:s.category}),v&&e.jsx(O,{before:"ðŸ”¥",after:`- ${m}% `,children:"Discount applied"})]}),e.jsxs(C,{header:"Order Details",children:[e.jsx(N,{header:"Link",placeholder:G,value:u,onChange:c=>M(c.target.value),status:!u.trim()&&u.length>0?"error":"default"}),K&&!F&&e.jsx(N,{header:"Quantity",placeholder:`Min: ${s.min} `,type:"number",value:f,onChange:c=>y(c.target.value)}),F&&e.jsx(ne,{header:"Comments (One per line)",placeholder:"Enter list of comments...",value:A,onChange:B}),W&&e.jsx(N,{header:"Answer Number",type:"number",value:q,onChange:c=>L(c.target.value)})]}),!h&&e.jsx(C,{children:e.jsx(oe,{size:"l",stretched:!0,disabled:!T||o,onClick:I,loading:o,children:o?"Ordering...":`Pay ${S(l)} `})})]})}function pe(){const{services:d,recommendedIds:p,selectedPlatform:n,selectedCategory:a,selectedService:m,setSelectedPlatform:i,setSelectedCategory:t,setSelectedService:h,discountPercent:j,holidayName:$,marqueeText:P}=U(),[b,u]=r.useState(!1),[M,f]=r.useState(!1),y=r.useMemo(()=>{if(!n)return[];if(n==="top")return["Top Services"];const o=R.find(s=>s.id===n);if(!o)return[];const w=[...new Set(d.map(s=>s.category))];if(n==="other"){const s=R.filter(l=>l.id!=="other"&&l.id!=="top").flatMap(l=>l.keywords);return w.filter(l=>{const v=l.toLowerCase();return!s.some(B=>v.includes(B))})}return w.filter(s=>{const l=s.toLowerCase();return o.keywords.some(v=>l.includes(v))})},[n,d]),A=r.useMemo(()=>a?a==="Top Services"?d.filter(o=>p.includes(o.id)):d.filter(o=>o.category===a):[],[a,d,p]),k=r.useCallback(o=>{i(o),o==="top"?(t("Top Services"),f(!0)):u(!0)},[i,t]),q=r.useCallback(o=>{t(o),u(!1),f(!0)},[t]),L=r.useCallback(o=>{h(o),f(!1)},[h]);return e.jsxs("div",{className:"order-page",children:[P&&e.jsx("div",{className:"op-marquee",children:e.jsx("div",{className:"op-marquee-inner",children:P})}),j>0&&e.jsxs("div",{className:"op-discount-banner",children:["ðŸ”¥ ",j,"% Off â€” ",$]}),e.jsx("div",{className:"op-platforms",children:e.jsx(ie,{selectedPlatform:n,onSelect:k})}),e.jsx("div",{className:"op-section-label",children:"1. Category"}),e.jsxs("button",{className:"op-dropdown",onClick:()=>{n&&(_(),u(!0))},disabled:!n,children:[e.jsx("span",{className:"op-dropdown-icon",children:"ðŸ“‚"}),e.jsx("span",{className:"op-dropdown-text",children:a||"Select Category"}),e.jsx("span",{className:"op-dropdown-arrow",children:"â–¾"})]}),e.jsx("div",{className:"op-section-label",children:"2. Service"}),e.jsxs("button",{className:"op-dropdown",onClick:()=>{a&&(_(),f(!0))},disabled:!a,children:[e.jsx("span",{className:"op-dropdown-icon",children:"ðŸ“‹"}),e.jsx("span",{className:"op-dropdown-text",children:m?m.name:"Select Service"}),e.jsx("span",{className:"op-dropdown-arrow",children:"â–¾"})]}),m&&e.jsx(de,{}),!m&&e.jsx("button",{className:"op-order-btn",disabled:!0,children:"Order"}),b&&e.jsx(le,{categories:y,onSelect:q,onClose:()=>u(!1)}),M&&e.jsx(ce,{services:A,onSelect:L,onClose:()=>f(!1)})]})}export{pe as OrderPage};
