import{j as e,r as n}from"./react-vendor-C-oIHjE7.js";import{P as _,h as H,f as N,u as G,g as J,Q as Z,c as V,s as ee,o as te,a as se,e as re,d as K,b as ae,i as Y}from"./index-DIIM9q27.js";import{M as O,L as W,b as w,I,P as z,C as $,c as ne,B as oe}from"./tma-ui-zNZ4TOi0.js";import"./tma-sdk-B1EfXx2E.js";function ie({selectedPlatform:r,onSelect:u}){return e.jsx("div",{style:{display:"flex",gap:8,overflowX:"auto",paddingBottom:4,scrollbarWidth:"none",msOverflowStyle:"none",WebkitOverflowScrolling:"touch"},children:_.map(a=>{const s=r===a.id;return e.jsxs("button",{onClick:()=>{H(),u(a.id)},style:{display:"flex",alignItems:"center",gap:6,padding:"8px 14px",background:s?"var(--tg-theme-button-color, #3390ec)":"var(--tg-theme-secondary-bg-color, #1e1e2e)",border:"none",borderRadius:20,cursor:"pointer",transition:"all 0.15s ease",WebkitTapHighlightColor:"transparent",color:s?"var(--tg-theme-button-text-color, #fff)":"var(--tg-theme-text-color, #fff)",whiteSpace:"nowrap",flexShrink:0,fontSize:13,fontWeight:500,fontFamily:"inherit"},children:[e.jsx("span",{style:{fontSize:16,lineHeight:1},children:a.icon}),e.jsx("span",{children:a.label})]},a.id)})})}function le({categories:r,onSelect:u,onClose:a}){const[s,h]=n.useState(""),i=n.useMemo(()=>{if(!s.trim())return r;const t=s.toLowerCase();return r.filter(o=>o.toLowerCase().includes(t))},[r,s]);return e.jsx(O,{open:!0,onOpenChange:t=>{t||a()},header:e.jsx(O.Header,{children:"Select Category"}),children:e.jsxs(W,{children:[e.jsx(w,{children:e.jsx(I,{placeholder:"Search categories...",value:s,onChange:t=>h(t.target.value)})}),i.length===0?e.jsx(z,{description:"No categories found"}):e.jsx(w,{children:i.map(t=>e.jsx($,{before:e.jsx("span",{style:{fontSize:18},children:"ðŸ“‚"}),onClick:()=>u(t),children:t},t))})]})})}function ce({services:r,onSelect:u,onClose:a}){const[s,h]=n.useState(""),i=n.useMemo(()=>{if(!s.trim())return r;const t=s.toLowerCase();return r.filter(o=>o.name.toLowerCase().includes(t)||o.id.toString().includes(t))},[r,s]);return e.jsx(O,{open:!0,onOpenChange:t=>{t||a()},header:e.jsx(O.Header,{children:"Select Service"}),snapPoints:[.85],children:e.jsxs(W,{children:[e.jsx(w,{children:e.jsx(I,{placeholder:"Search services...",value:s,onChange:t=>h(t.target.value)})}),i.length===0?e.jsx(z,{description:"No services found"}):e.jsx(w,{children:i.map(t=>e.jsx($,{multiline:!0,onClick:()=>u(t),description:e.jsxs("span",{style:{fontSize:12},children:["#",t.id," â€¢ ",t.min," â€“ ",t.max.toLocaleString(),t.averageTime&&` â€¢ â± ${t.averageTime}`,t.refill&&" â€¢ â™» Refill",t.cancel&&" â€¢ âœ• Cancel"]}),after:e.jsx("span",{style:{fontWeight:600,color:"var(--tg-theme-link-color)"},children:N(t.rate)}),children:t.name},t.id))})]})})}function de(){const{selectedService:r,selectedPlatform:u,selectedCategory:a,rateMultiplier:s,discountPercent:h,user:i,userCanOrder:t,isTelegramApp:o,showToast:f,setBalance:m,setOrders:L,orders:v}=G(),[g,B]=n.useState(""),[p,E]=n.useState(""),[k,F]=n.useState(""),[A,R]=n.useState(""),[b,D]=n.useState(!1),l=r,{charge:x,hasDiscount:Q}=n.useMemo(()=>{const C=(parseInt(p)||0)/1e3*l.rate*s;return{charge:h>0?C*(1-h/100):C,hasDiscount:h>0}},[p,l.rate,s,h]),c=n.useCallback(d=>{const C=d.target.value;if(F(C),["Custom Comments","Custom Comments Package","Mentions with Hashtags"].includes(l.type)){const y=C.split(`
`).filter(X=>X.trim());E(String(y.length))}},[l.type]),P=J(a||"",u||"other"),S=["Custom Comments","Custom Comments Package","Mentions with Hashtags"].includes(l.type),j=l.type!=="Package",M=l.type==="Poll",T=n.useMemo(()=>{if(!g.trim())return!1;const d=l.type==="Package"?l.min:parseInt(p);return!(!d||isNaN(d)||d<l.min||d>l.max||d%Z!==0||i&&x>i.balance||!t)},[g,p,l,x,i,t]),q=async()=>{if(T){D(!0);try{await new Promise(y=>setTimeout(y,1200));const d=l.type==="Package"?l.min:parseInt(p),C={id:v.length+100,api_order_id:9e4+v.length,service_id:l.id,service_name:l.name,link:g,quantity:d,charge:x,status:"pending",remains:d,start_count:0,created_at:new Date().toISOString()};L([C,...v]),i&&m(i.balance-x),f("success",`Order #${C.api_order_id} placed!`),ae("heavy"),Y("success"),B(""),E(""),F(""),R("")}catch{f("error","Failed to place order"),Y("error")}finally{D(!1)}}},U=n.useRef(q);return n.useEffect(()=>{U.current=q},[q]),n.useEffect(()=>{if(!o)return;const d=()=>U.current();if(b)V({text:"PLACING ORDER...",isEnabled:!0,isLoaderVisible:!0});else if(T)V({text:`PAY ${N(x)}`,color:"#2ecc71",textColor:"#ffffff",isEnabled:!0,isLoaderVisible:!1});else{let y="FILL DETAILS";g.trim()?i&&x>i.balance?y="INSUFFICIENT FUNDS":y="INVALID QUANTITY":y="ENTER LINK",V({text:y,color:"#95a5a6",textColor:"#ffffff",isEnabled:!1,isLoaderVisible:!1})}ee();const C=te(d);return()=>{C(),se()}},[o,T,b,x,g,i]),n.useEffect(()=>((g||p)&&!b?re():K(),()=>K()),[g,p,b]),e.jsxs(e.Fragment,{children:[e.jsxs(w,{header:`Selected Service: ${l.name} `,footer:i&&x>i.balance?`Insufficient Balance(Have: ${N(i.balance)})`:`Total Charge: ${N(x)} `,children:[e.jsx($,{subtitle:`${l.min} - ${l.max.toLocaleString()} â€¢ Rate: ${N(l.rate)} `,multiline:!0,children:l.category}),Q&&e.jsx($,{before:"ðŸ”¥",after:`- ${h}% `,children:"Discount applied"})]}),e.jsxs(w,{header:"Order Details",children:[e.jsx(I,{header:"Link",placeholder:P,value:g,onChange:d=>B(d.target.value),status:!g.trim()&&g.length>0?"error":"default"}),j&&!S&&e.jsx(I,{header:"Quantity",placeholder:`Min: ${l.min} `,type:"number",value:p,onChange:d=>E(d.target.value)}),S&&e.jsx(ne,{header:"Comments (One per line)",placeholder:"Enter list of comments...",value:k,onChange:c}),M&&e.jsx(I,{header:"Answer Number",type:"number",value:A,onChange:d=>R(d.target.value)})]}),!o&&e.jsx(w,{children:e.jsx(oe,{size:"l",stretched:!0,disabled:!T||b,onClick:q,loading:b,children:b?"Ordering...":`Pay ${N(x)} `})})]})}function ue(r,u){if(!u)return e.jsx(e.Fragment,{children:r});const a=r.toLowerCase().indexOf(u.toLowerCase());return a===-1?e.jsx(e.Fragment,{children:r}):e.jsxs(e.Fragment,{children:[r.slice(0,a),e.jsx("mark",{style:{background:"var(--tg-theme-accent-text-color, rgba(108,92,231,0.3))",color:"var(--tg-theme-text-color)",borderRadius:2,padding:"0 2px",opacity:.7},children:r.slice(a,a+u.length)}),r.slice(a+u.length)]})}function he({services:r,onSelect:u,onClose:a}){const[s,h]=n.useState(""),i=n.useMemo(()=>{const o=s.trim().toLowerCase();if(!o)return[];const f=o.split(/\s+/);return r.filter(m=>{const L=`${m.name} ${m.category} ${m.id}`.toLowerCase();return f.every(v=>L.includes(v))}).slice(0,30)},[r,s]),t=n.useMemo(()=>{const o=new Map;for(const f of i){const m=o.get(f.category)||[];m.push(f),o.set(f.category,m)}return o},[i]);return e.jsx(O,{open:!0,onOpenChange:o=>{o||a()},header:e.jsx(O.Header,{children:"ðŸ” Search All Services"}),snapPoints:[.9],children:e.jsxs(W,{children:[e.jsx(w,{children:e.jsx(I,{placeholder:"Search by name, ID, or category...",value:s,onChange:o=>h(o.target.value)})}),s.trim()===""?e.jsx(z,{description:"Start typing to search across all services"}):i.length===0?e.jsx(z,{description:"No services match your search"}):Array.from(t.entries()).map(([o,f])=>e.jsx(w,{header:o,children:f.map(m=>e.jsx($,{multiline:!0,onClick:()=>u(m),description:e.jsxs("span",{style:{fontSize:12},children:["#",m.id," â€¢ ",N(m.rate),"/1K"]}),children:ue(m.name,s.trim())},m.id))},o))]})})}function xe(){const{services:r,recommendedIds:u,selectedPlatform:a,selectedCategory:s,selectedService:h,setSelectedPlatform:i,setSelectedCategory:t,setSelectedService:o,discountPercent:f,holidayName:m,marqueeText:L,user:v,setActiveTab:g}=G(),[B,p]=n.useState(!1),[E,k]=n.useState(!1),[F,A]=n.useState(!1),R=n.useMemo(()=>{if(!a)return[];if(a==="top")return["Top Services"];const c=_.find(S=>S.id===a);if(!c)return[];const P=[...new Set(r.map(S=>S.category))];if(a==="other"){const S=_.filter(j=>j.id!=="other"&&j.id!=="top").flatMap(j=>j.keywords);return P.filter(j=>{const M=j.toLowerCase();return!S.some(T=>M.includes(T))})}return P.filter(S=>{const j=S.toLowerCase();return c.keywords.some(M=>j.includes(M))})},[a,r]),b=n.useMemo(()=>s?s==="Top Services"?r.filter(c=>u.includes(c.id)):r.filter(c=>c.category===s):[],[s,r,u]),D=n.useCallback(c=>{i(c),c==="top"?(t("Top Services"),k(!0)):p(!0)},[i,t]),l=n.useCallback(c=>{t(c),p(!1),k(!0)},[t]),x=n.useCallback(c=>{o(c),k(!1)},[o]),Q=n.useCallback(c=>{const P=c.category.toLowerCase(),S=_.find(j=>j.keywords.some(M=>P.includes(M)));i(S?.id||"other"),t(c.category),o(c),A(!1)},[i,t,o]);return e.jsxs("div",{className:"order-page",children:[e.jsxs("div",{className:"op-header",children:[e.jsxs("div",{className:"op-header-left",children:[e.jsx("div",{className:"op-logo",children:e.jsx("span",{className:"op-logo-icon",children:"ðŸš€"})}),e.jsxs("div",{className:"op-header-info",children:[e.jsx("span",{className:"op-brand",children:"Paxyo"}),e.jsxs("span",{className:"op-balance",children:["Balance ",v?N(v.balance):"..."]})]})]}),e.jsxs("div",{className:"op-header-actions",children:[e.jsx("button",{className:"op-icon-btn",onClick:()=>A(!0),"aria-label":"Search",children:"ðŸ”"}),e.jsx("button",{className:"op-icon-btn op-notif-btn",onClick:()=>{H(),g("ticket")},"aria-label":"Notifications",children:"ðŸ””"})]})]}),L&&e.jsx("div",{className:"op-marquee",children:e.jsx("div",{className:"op-marquee-inner",children:L})}),f>0&&e.jsxs("div",{className:"op-discount-banner",children:["ðŸ”¥ ",f,"% Off â€” ",m]}),e.jsx("div",{className:"op-platforms",children:e.jsx(ie,{selectedPlatform:a,onSelect:D})}),e.jsx("div",{className:"op-section-label",children:"1. Category"}),e.jsxs("button",{className:"op-dropdown",onClick:()=>{a&&(H(),p(!0))},disabled:!a,children:[e.jsx("span",{className:"op-dropdown-icon",children:"ðŸ“‚"}),e.jsx("span",{className:"op-dropdown-text",children:s||"Select Category"}),e.jsx("span",{className:"op-dropdown-arrow",children:"â–¾"})]}),e.jsx("div",{className:"op-section-label",children:"2. Service"}),e.jsxs("button",{className:"op-dropdown",onClick:()=>{s&&(H(),k(!0))},disabled:!s,children:[e.jsx("span",{className:"op-dropdown-icon",children:"ðŸ“‹"}),e.jsx("span",{className:"op-dropdown-text",children:h?h.name:"Select Service"}),e.jsx("span",{className:"op-dropdown-arrow",children:"â–¾"})]}),h&&e.jsx(de,{}),!h&&e.jsx("button",{className:"op-order-btn",disabled:!0,children:"Order"}),B&&e.jsx(le,{categories:R,onSelect:l,onClose:()=>p(!1)}),E&&e.jsx(ce,{services:b,onSelect:x,onClose:()=>k(!1)}),F&&e.jsx(he,{services:r,onSelect:Q,onClose:()=>A(!1)})]})}export{xe as OrderPage};
